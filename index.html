<!DOCTYPE html>
<html>
<head>
  <title>MouseCity Bank</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap');
    body {
      background-color: #0a3d3d;
      color: white;
      font-family: 'Lato', sans-serif;
      margin: 0;
      padding: 20px;
      backdrop-filter: blur(8px);
      display: flex;
      justify-content: center;
    }
    h2 {
      font-size: 26px;
      margin-bottom: 16px;
      text-align: center;
      font-weight: 700;
      color: #b2f0e6;
    }
    .main-wrapper {
      max-width: 680px;
      width: 100%;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
    }
    .column {
      flex: 1;
      min-width: 180px;
      max-width: 220px;
    }
    .item {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      padding: 10px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 16px;
      backdrop-filter: blur(5px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
    }
    .item:hover {
        transform: translateY(-2px);
    }
    .name-wrapper {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
    }
    .name-text {
      font-weight: 700;
    }
    .punkte-text {
      color: #d1d1d1;
      font-weight: 400;
    }
    .color-circle {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.3);
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .ausland-wrapper {
      display: none;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
      width: 100%;
    }
    .ausland-wrapper.show {
      display: flex;
    }
    .ausland-item {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      padding: 10px;
      font-size: 14px;
      width: calc(33% - 8px);
      box-sizing: border-box;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAdPN2duh89Fx5rmYlFshdf0juhYNX_7fg",
      authDomain: "punkte-45c20.firebaseapp.com",
      databaseURL: "https://punkte-45c20-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "punkte-45c20",
      storageBucket: "punkte-45c20.appspot.com",
      messagingSenderId: "931713539549",
      appId: "1:931713539549:web:e348bf38369639f1906a34"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const farben = ["âšª", "ðŸ”µ", "ðŸŸ¡", "ðŸŸ¢", "âš«", "ðŸŸ£"];

    window.onload = () => {
      const refKinder = ref(db, "kinder");
      onValue(refKinder, (snapshot) => {
        renderData(snapshot);
      });
    };

    function renderData(snapshot) {
      const appContainer = document.getElementById("app");
      appContainer.innerHTML = "<h2>MouseCity Bank</h2>";
      const mainWrapper = document.createElement("div");
      mainWrapper.className = "main-wrapper";
      const wrapper = document.createElement("div");
      wrapper.className = "container";

      const normaleKonten = [];
      const auslandskonten = [];

      snapshot.forEach(childSnap => {
        const name = childSnap.key;
        const data = childSnap.val();
        if (data.farbe === undefined) {
          auslandskonten.push({ name, punkte: data.punkte || 0 });
        } else {
          normaleKonten.push({ name, punkte: data.punkte || 0, farbe: data.farbe });
        }
      });

      const spaltenAnzahl = 3;
      const kinderProSpalte = Math.ceil(normaleKonten.length / spaltenAnzahl);

      const auslandWrapper = document.createElement("div");
      auslandWrapper.className = "ausland-wrapper";

      const toggleBtn = document.createElement("div");
      toggleBtn.className = "item";
      toggleBtn.style.justifyContent = "center";
      toggleBtn.style.cursor = "pointer";
      toggleBtn.textContent = "Auslandskonten â¬‡";

      toggleBtn.onclick = () => {
        auslandWrapper.classList.toggle("show");
        toggleBtn.textContent = auslandWrapper.classList.contains("show")
          ? "Auslandskonten â¬†"
          : "Auslandskonten â¬‡";
      };

      auslandskonten.forEach(({ name, punkte }) => {
        const item = document.createElement("div");
        item.className = "ausland-item";
        item.textContent = `${name} â€“ ${punkte}`;
        auslandWrapper.appendChild(item);
      });

      for (let i = 0; i < normaleKonten.length; i += kinderProSpalte) {
        const column = document.createElement("div");
        column.className = "column";
        normaleKonten.slice(i, i + kinderProSpalte).forEach(({ name, punkte, farbe }) => {
          const item = document.createElement("div");
          item.className = "item";

          const nameWrapper = document.createElement("div");
          nameWrapper.className = "name-wrapper";

          const nameSpan = document.createElement("span");
          nameSpan.className = "name-text";
          nameSpan.textContent = name;
          nameSpan.style.color = "white"; // Name bleibt weiÃŸ

          const colorCircle = document.createElement("div");
          colorCircle.className = "color-circle";
          colorCircle.style.backgroundColor = farbeToColor(farbe);
          colorCircle.onclick = (event) => {
            event.stopPropagation(); // Verhindert, dass der Klick das ganze Element auslÃ¶st
            toggleFarbe(name, farbe);
          };

          nameWrapper.appendChild(nameSpan);
          nameWrapper.appendChild(colorCircle);
          
          const punkteSpan = document.createElement("span");
          punkteSpan.className = "punkte-text";
          punkteSpan.textContent = `(${punkte})`;

          item.appendChild(nameWrapper);
          item.appendChild(punkteSpan);
          column.appendChild(item);
        });
        wrapper.appendChild(column);
      }
      
      const lastColumn = wrapper.lastElementChild;
      if (lastColumn) {
        lastColumn.appendChild(toggleBtn);
        lastColumn.appendChild(auslandWrapper);
      } else {
        wrapper.appendChild(toggleBtn);
        wrapper.appendChild(auslandWrapper);
      }

      mainWrapper.appendChild(wrapper);
      appContainer.appendChild(mainWrapper);
    }

    function toggleFarbe(name, aktuelleFarbe) {
      const idx = (farben.indexOf(aktuelleFarbe) + 1) % farben.length;
      update(ref(db, `kinder/${name}`), { farbe: farben[idx] });
    }

    function farbeToColor(f) {
      if (f === "ðŸ”µ") return "#1e90ff";
      if (f === "ðŸŸ¡") return "#ffd700";
      if (f === "ðŸŸ¢") return "#32cd32";
      if (f === "âš«") return "#444";
      if (f === "ðŸŸ£") return "#ff69b4";
      return "#f0f0f0";
    }
  </script>
</head>
<body>
  <div id="app"></div>
</body>
</html>
