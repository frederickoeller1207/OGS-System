<!DOCTYPE html>
<html>
<head>
  <title>MouseCity Bank</title>
  <style>
    body {
      background-color: #0a3d0a;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 20px;
      backdrop-filter: blur(4px);
    }
    h2 {
      font-size: 26px;
      margin-bottom: 16px;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .column {
      flex: 1;
      min-width: 180px;
      max-width: 220px;
    }
    .item {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 10px;
      padding: 6px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      backdrop-filter: blur(3px);
    }
    button {
      background-color: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 2px 8px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }
    .small-button {
      padding: 2px 8px;
      font-size: 14px;
      border-radius: 6px;
      margin-top: 4px;
    }
    .ausland-wrapper {
      display: none;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
      width: 100%;
    }
    .ausland-wrapper.show {
      display: flex;
    }
    .ausland-item {
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      padding: 8px 10px;
      font-size: 13px;
      width: calc(33% - 8px);
      box-sizing: border-box;
      text-align: center;
    }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getDatabase, ref, onValue, update, get } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAdPN2duh89Fx5rmYlFshdf0juhYNX_7fg",
      authDomain: "punkte-45c20.firebaseapp.com",
      databaseURL: "https://punkte-45c20-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "punkte-45c20",
      storageBucket: "punkte-45c20.appspot.com",
      messagingSenderId: "931713539549",
      appId: "1:931713539549:web:e348bf38369639f1906a34"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const farben = ["âšª", "ðŸ”´", "ðŸŸ¡", "ðŸŸ¢", "âš«", "ðŸŸ£"];

    window.onload = () => {
      const refKinder = ref(db, "kinder");
      onValue(refKinder, (snapshot) => {
        renderData(snapshot);
      });
    };

    function renderData(snapshot) {
      const container = document.getElementById("app");
      container.innerHTML = "<h2>MouseCity Bank</h2>";
      const wrapper = document.createElement("div");
      wrapper.className = "container";

      const normaleKonten = [];
      const auslandskonten = [];

      snapshot.forEach(childSnap => {
        const name = childSnap.key;
        const data = childSnap.val();
        if (data.farbe === undefined) {
          auslandskonten.push({ name, punkte: data.punkte || 0 });
        } else {
          normaleKonten.push({ name, punkte: data.punkte || 0, farbe: data.farbe });
        }
      });

      const spaltenAnzahl = 3;
      const kinderProSpalte = Math.ceil(normaleKonten.length / spaltenAnzahl);

      for (let i = 0; i < normaleKonten.length; i += kinderProSpalte) {
        const column = document.createElement("div");
        column.className = "column";
        normaleKonten.slice(i, i + kinderProSpalte).forEach(({ name, punkte, farbe }) => {
          const item = document.createElement("div");
          item.className = "item";

          const nameSpan = document.createElement("span");
          nameSpan.textContent = name;
          nameSpan.style.color = farbeToColor(farbe);
          nameSpan.style.cursor = "pointer";
          nameSpan.onclick = () => toggleFarbe(name, farbe);

          const punkteSpan = document.createElement("span");
          punkteSpan.textContent = `(${punkte}) â€“ ${farbe}`;

          const plus = document.createElement("button");
          plus.textContent = "+";
          plus.onclick = () => changePunkte(name, 1);

          const minus = document.createElement("button");
          minus.textContent = "â€“";
          minus.onclick = () => changePunkte(name, -1);

          item.appendChild(nameSpan);
          item.appendChild(punkteSpan);
          item.appendChild(plus);
          item.appendChild(minus);
          column.appendChild(item);
        });
        wrapper.appendChild(column);
      }

      const toggleBtn = document.createElement("button");
      toggleBtn.className = "small-button";
      toggleBtn.textContent = "Auslandskonten â¬‡";

      const auslandWrapper = document.createElement("div");
      auslandWrapper.className = "ausland-wrapper";

      toggleBtn.onclick = () => {
        auslandWrapper.classList.toggle("show");
        toggleBtn.textContent = auslandWrapper.classList.contains("show")
          ? "Auslandskonten â¬†"
          : "Auslandskonten â¬‡";
      };
      wrapper.appendChild(toggleBtn);

      auslandskonten.forEach(({ name, punkte }) => {
        const item = document.createElement("div");
        item.className = "ausland-item";
        item.textContent = `${name} â€“ ${punkte}`;
        auslandWrapper.appendChild(item);
      });

      wrapper.appendChild(auslandWrapper);
      container.appendChild(wrapper);

      const gruenBtn = document.createElement("button");
      gruenBtn.textContent = "Alle auf GrÃ¼n";
      gruenBtn.onclick = () => {
        normaleKonten.forEach(({ name }) =>
          update(ref(db, `kinder/${name}`), { farbe: "ðŸŸ¢" })
        );
      };

      const resetUndAuswerten = document.createElement("button");
      resetUndAuswerten.textContent = "DurchfÃ¼hren";
      resetUndAuswerten.onclick = () => {
        normaleKonten.forEach(({ name, farbe, punkte }) => {
          let delta = 0;
          if (farbe === "ðŸŸ¢") delta = 1;
          else if (farbe === "ðŸ”´") delta = -1;
          else if (farbe === "âš«") delta = -2;
          else if (farbe === "ðŸŸ£") delta = 2;
          update(ref(db, `kinder/${name}`), {
            punkte: punkte + delta,
            farbe: "âšª"
          });
        });
      };

      container.appendChild(document.createElement("br"));
      container.appendChild(gruenBtn);
      container.appendChild(resetUndAuswerten);
    }

    function toggleFarbe(name, aktuelleFarbe) {
      const idx = (farben.indexOf(aktuelleFarbe) + 1) % farben.length;
      update(ref(db, `kinder/${name}`), { farbe: farben[idx] });
    }

    function changePunkte(name, delta) {
      const refName = ref(db, `kinder/${name}`);
      get(refName).then(snapshot => {
        const val = snapshot.val() || { punkte: 0 };
        update(refName, { punkte: val.punkte + delta });
      });
    }

    function farbeToColor(f) {
      if (f === "ðŸ”´") return "red";
      if (f === "ðŸŸ¡") return "orange";
      if (f === "ðŸŸ¢") return "lime";
      if (f === "âš«") return "black";
      if (f === "ðŸŸ£") return "deeppink";
      return "white";
    }
  </script>
</head>
<body>
  <div id="app"></div>
</body>
</html>